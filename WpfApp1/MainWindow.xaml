<Window x:Class="WpfApp1.MainWindow" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:gu="https://github.com/JohanLarsson/Gu.Wpf" xmlns:local="clr-namespace:WpfApp1"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:mx="clr-namespace:WpfLib.MarkupExtensions;assembly=WpfLib"
        xmlns:system="clr-namespace:System;assembly=mscorlib" Name="TheWindow" Title="MainWindow"
        Width="614" Height="352" Closing="Window_Closing" mc:Ignorable="d">
    <Window.Resources>
        <local:SnapGridConverter x:Key="SnapGridConverter" />
        <Brush x:Key="SplitterColor">red</Brush>
        <system:Double x:Key="SplitterSize">5</system:Double>
    </Window.Resources>
    <Grid gu:Grid.Layout="auto * auto, * auto 100">

        <StackPanel Grid.ColumnSpan="3" gu:Cell.Index="0 0" Orientation="Horizontal">
            <StackPanel.Resources>
                <Style TargetType="{x:Type Button}">
                    <Setter Property="Margin" Value="0,0,10,0" />
                </Style>
                <Style TargetType="{x:Type CheckBox}">
                    <Setter Property="Margin" Value="0,0,10,0" />
                    <Setter Property="VerticalAlignment" Value="Center" />
                </Style>
                <Style TargetType="{x:Type TextBox}">
                    <Setter Property="Margin" Value="0,0,10,0" />
                </Style>
            </StackPanel.Resources>
            <Button Name="AddConveyorB" Content="Add" Click="AddConveyorB_Click" ToolTip="Add Conveyor" />
            <CheckBox Name="RunningCB" Content="Running" Checked="RunningCB_Click" Unchecked="RunningCB_Click" />
            <Button Name="PutItemB" Content="Put" Click="PutItemB_Click" ToolTip="Put Items" />
            <CheckBox Name="FirstOnlyCB" Content="FirstOnly" />
            <Button Name="MovePointB" Content="Move" Click="MovePointB_Click" />
            <Button Name="SelectB" Content="Select" Click="SelectB_Click" />
            <TextBox Name="LanesCountTB" Text="2" ToolTip="Lanes Count" />
            <TextBox Name="GridWidth" Width="30"
                     Text="{Binding Path=SnapGridWidth, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:MainWindow}}"
                     ToolTip="Grid Width" />
            <TextBlock Name="SelectionInfoT" Text="(Please select something)" />
        </StackPanel>
        <TextBlock Name="NotesLabel" Grid.ColumnSpan="2" gu:Cell.Index="2 0" />
        <GridSplitter Width="{StaticResource SplitterSize}"
                      HorizontalAlignment="Center" VerticalAlignment="Stretch" gu:Cell.Index="1 1"
                      Background="{StaticResource SplitterColor}" />
        <Grid gu:Cell.Index="1 2" gu:Grid.Layout="* auto *, *">
            <TextBlock gu:Cell.Index="0 0" Text="{Binding Path=SelectedObject.Text, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:MainWindow}}" />
            <GridSplitter Grid.Row="1"
                          Height="{StaticResource SplitterSize}"
                          HorizontalAlignment="Stretch" VerticalAlignment="Center"
                          Background="{StaticResource SplitterColor}" />
            <avalonEdit:TextEditor Name="textEditor2" gu:Cell.Index="2 0" FontFamily="Fira Code" FontSize="8pt" SyntaxHighlighting="C#" />
        </Grid>
        <Grid gu:Cell.Index="1 0" gu:Grid.Layout="* auto auto, *">

            <ScrollViewer gu:Cell.Index="0 0" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden">
                <Canvas Name="TheCanvas" Background="Green" MouseDown="TheCanvas_MouseDown" MouseMove="TheCanvas_MouseMove"
                        MouseUp="TheCanvas_MouseUp" MouseWheel="TheCanvas_MouseWheel">
                    <ItemsControl Name="SnapGridIC"
                                  ItemsSource="{mx:MultiBinding {Binding ElementName=TheCanvas, Path=ActualWidth},
                                                                {Binding ElementName=TheCanvas, Path=ActualHeight},
                                                                {Binding Path=SnapGridWidth, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:MainWindow}},
                                                                Converter={StaticResource SnapGridConverter}}"
                                  Visibility="Visible">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Canvas.Left" Value="{Binding Path=X}" />
                                <Setter Property="Canvas.Top" Value="{Binding Path=Y}" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Ellipse Width="1" Height="1" Fill="WhiteSmoke" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Canvas.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform x:Name="CanvasScaleTransform" />
                            <TranslateTransform x:Name="CanvasTranslateTransform" />
                        </TransformGroup>
                    </Canvas.RenderTransform>

                </Canvas>
            </ScrollViewer>
            <GridSplitter Grid.Row="1"
                          Height="{StaticResource SplitterSize}"
                          HorizontalAlignment="Stretch" VerticalAlignment="Center"
                          Background="{StaticResource SplitterColor}" />
            <Grid gu:Cell.Index="2 0" gu:Grid.Layout="* , * auto">
                <avalonEdit:TextEditor Name="textEditor" gu:Cell.Index="0 0" FontFamily="Fira Code" FontSize="10pt" SyntaxHighlighting="C#">
                    $.AddConveyor(new V2d[]{(30, 60), (60, 60), (60, 90)}, false, 2)
                </avalonEdit:TextEditor>
                <Button Name="RunB" gu:Cell.Index="0 1" Click="RunB_Click" IsEnabled="False">
                    <TextBlock>
                        <TextBlock.LayoutTransform>
                            <RotateTransform Angle="90" CenterX="0.5" CenterY="0.5" />
                        </TextBlock.LayoutTransform>
                        Run
                    </TextBlock>
                </Button>
            </Grid>
        </Grid>
    </Grid>
</Window>
